<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طبيبك - حجز الاستشارات الطبية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #036447;
            --accent-color: #036447;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #047c58;
            --warning-color: #f39c12;
            --text-color: #333;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            padding-bottom: 70px;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            right: -280px;
            width: var(--sidebar-width);
            height: 100%;
            background-color: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: var(--transition);
            overflow-y: auto;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .sidebar-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-sidebar {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-sidebar:hover {
            color: var(--accent-color);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-color);
            transition: var(--transition);
        }

        .sidebar-menu a:hover {
            background-color: var(--light-color);
            color: var(--secondary-color);
        }

        .sidebar-menu a i {
            margin-left: 10px;
            width: 24px;
            text-align: center;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--primary-color);
            font-size: 24px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .governorates-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .governorate-btn {
            padding: 10px;
            background-color: var(--light-color);
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .governorate-btn:hover {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .governorate-btn.active {
            background-color: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }

        .governorate-btn.active::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 12px;
        }

        .modal-footer {
            display: flex;
            justify-content: space-between;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--accent-color);
        }

        .btn-secondary {
            background-color: var(--light-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #ddd;
        }

        /* Navbar Styles */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: var(--shadow);
            z-index: 100;
            padding: 15px 0;
            transition: var(--transition);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-left: 10px;
            color: var(--secondary-color);
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary-color);
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 20px;
            position: relative;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .nav-links a:hover {
            color: var(--secondary-color);
        }

        .nav-links a i {
            margin-left: 5px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            position: relative;
            cursor: pointer;
        }

        .user-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 10px;
        }

        .user-dropdown {
            position: absolute;
            top: 50px;
            left: 0;
            background-color: white;
            box-shadow: var(--shadow);
            border-radius: 5px;
            width: 200px;
            padding: 10px 0;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 10;
        }

        .user-profile:hover .user-dropdown {
            opacity: 1;
            visibility: visible;
            top: 45px;
        }

        .user-dropdown a {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: var(--text-color);
            transition: var(--transition);
        }

        .user-dropdown a:hover {
            background-color: var(--light-color);
            color: var(--secondary-color);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
        }

        .bottom-nav-container {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-color);
            font-size: 12px;
            transition: var(--transition);
        }

        .bottom-nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .bottom-nav-item.active {
            color: var(--secondary-color);
        }

        /* Main Content Styles */
        .main-content {
            margin-top: 80px;
            padding: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .user-header {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .user-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--secondary-color);
            margin-left: 20px;
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: rotate(10deg) scale(1.05);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .user-phone {
            color: #666;
            font-size: 16px;
        }

        .governorate-selector {
            margin-top: 10px;
        }

        .select-governorate {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 200px;
            font-size: 14px;
        }

        /* Specialties Grid */
        .specialties-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--secondary-color), var(--accent-color));
        }

        .search-container {
            margin-bottom: 20px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border-radius: 30px;
            border: 1px solid #ddd;
            font-size: 16px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            padding-right: 50px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .search-icon {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            color: #666;
        }

        .specialties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .specialty-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .specialty-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .specialty-card:hover .specialty-icon i {
            animation: bounce 1s infinite;
        }

        .specialty-icon {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 40px;
            position: relative;
            overflow: hidden;
        }

        .specialty-icon::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1)
            );
            transform: rotate(30deg);
            transition: var(--transition);
        }

        .specialty-card:hover .specialty-icon::after {
            transform: rotate(30deg) translate(10%, 10%);
        }

        .specialty-info {
            padding: 15px;
        }

        .specialty-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .specialty-doctors {
            color: #666;
            font-size: 14px;
        }

        /* Doctors Modal */
        .doctors-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .doctors-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .doctors-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .doctors-modal.active .doctors-container {
            transform: translateY(0);
        }

        .doctors-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background-color: white;
            z-index: 1;
        }

        .doctors-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-doctors {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-doctors:hover {
            color: var(--accent-color);
        }

        .doctors-list {
            padding: 20px;
        }

        .doctor-card {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            transition: var(--transition);
            position: relative;
        }

        .doctor-card:hover {
            background-color: #f0f0f0;
            transform: translateX(5px);
        }

        .doctor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 15px;
            border: 2px solid var(--secondary-color);
            transition: var(--transition);
        }

        .doctor-card:hover .doctor-avatar {
            transform: scale(1.1);
        }

        .doctor-info {
            flex: 1;
        }

        .doctor-name {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .doctor-specialty {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .doctor-phone {
            color: var(--secondary-color);
            font-size: 14px;
        }

        .view-doctor {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .view-doctor:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: none;
            border: none;
            font-size: 20px;
            color: #ccc;
            cursor: pointer;
            transition: var(--transition);
            z-index: 2;
        }

        .favorite-btn.active {
            color: #f44336;
        }

        /* Doctor Details Modal */
        .doctor-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .doctor-details-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .doctor-details-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .doctor-details-modal.active .doctor-details-container {
            transform: translateY(0);
        }

        .doctor-details-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .doctor-details-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-doctor-details {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-doctor-details:hover {
            color: var(--accent-color);
        }

        .doctor-details-body {
            padding: 20px;
        }

        .doctor-main-info {
            display: flex;
            margin-bottom: 20px;
        }

        .doctor-details-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 20px;
            border: 3px solid var(--secondary-color);
            transition: var(--transition);
        }

        .doctor-details-avatar:hover {
            transform: rotate(5deg) scale(1.05);
        }

        .doctor-details-text {
            flex: 1;
        }

        .doctor-details-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .doctor-details-specialty {
            color: var(--secondary-color);
            font-size: 16px;
            margin-bottom: 5px;
        }

        .doctor-details-phone, .doctor-details-location {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .doctor-details-phone i, .doctor-details-location i {
            margin-left: 5px;
        }

        .doctor-schedule {
            margin-top: 20px;
        }

        .schedule-title {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }

        .schedule-days {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .schedule-day {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            transition: var(--transition);
        }

        .schedule-day:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .day-name {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .schedule-day:hover .day-name {
            color: white;
        }

        .day-time {
            color: #666;
            font-size: 14px;
        }

        .schedule-day:hover .day-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .doctor-description {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.6;
        }

        .doctor-rating {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .rating-stars {
            color: #f39c12;
            margin-left: 5px;
        }

        .rating-count {
            color: #666;
            font-size: 14px;
            margin-left: 5px;
        }

        .doctor-price {
            font-weight: 700;
            color: var(--secondary-color);
            margin-top: 5px;
        }

        .book-consultation-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 700;
            margin-top: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .book-consultation-btn:hover {
            background-color: #07703f;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        /* Consultation Modal */
        .consultation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .consultation-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .consultation-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .consultation-modal.active .consultation-container {
            transform: translateY(0);
        }

        .consultation-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .consultation-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-consultation {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-consultation:hover {
            color: var(--accent-color);
        }

        .consultation-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--primary-color);
        }

        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .submit-consultation {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 700;
            margin-top: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .submit-consultation:hover {
            background-color: #219653;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        /* AI Chat Modal */
        .ai-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .ai-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .ai-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .ai-modal.active .ai-container {
            transform: translateY(0);
        }

        .ai-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-ai {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-ai:hover {
            color: var(--accent-color);
        }

        .ai-chat {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            position: relative;
            animation: fadeIn 0.3s ease forwards;
        }

        .user-message {
            align-self: flex-end;
            background-color: var(--secondary-color);
            color: white;
            border-bottom-right-radius: 0;
        }

        .ai-message {
            align-self: flex-start;
            background-color: #f0f0f0;
            color: var(--text-color);
            border-bottom-left-radius: 0;
        }

        .ai-input-container {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
        }

        .ai-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 30px;
            font-size: 14px;
            transition: var(--transition);
        }

        .ai-input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .send-ai {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-right: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .send-ai:hover {
            background-color: #2980b9;
            transform: rotate(360deg);
        }

        /* Profile Modal */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .profile-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .profile-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .profile-modal.active .profile-container {
            transform: translateY(0);
        }

        .profile-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-profile {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-profile:hover {
            color: var(--accent-color);
        }

        .profile-body {
            padding: 20px;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--secondary-color);
            margin-bottom: 15px;
        }

        .profile-name {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .profile-email {
            color: #666;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .profile-details {
            width: 100%;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .detail-label {
            font-weight: 500;
            color: var(--primary-color);
        }

        .detail-value {
            color: #666;
        }

        /* Settings Modal */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .settings-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
        }

        .settings-modal.active .settings-container {
            transform: translateY(0);
        }

        .settings-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-settings:hover {
            color: var(--accent-color);
        }

        .settings-body {
            padding: 20px;
        }

        .settings-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .settings-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .settings-tab.active {
            border-bottom-color: var(--secondary-color);
            color: var(--secondary-color);
            font-weight: 500;
        }

        .settings-content {
            display: none;
        }

        .settings-content.active {
            display: block;
        }

        /* Map Modal */
        .map-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 20px;
        }

        .map-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .map-container {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 800px;
            height: 80vh;
            box-shadow: var(--shadow);
            transform: translateY(-50px);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .map-modal.active .map-container {
            transform: translateY(0);
        }

        .map-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .close-map {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .close-map:hover {
            color: var(--accent-color);
        }

        .map-body {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .map-info {
            margin-bottom: 20px;
        }

        .map-info h3 {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .map-info p {
            color: #666;
            margin-bottom: 5px;
        }

        #doctorMap {
            flex: 1;
            width: 100%;
            border-radius: 5px;
            overflow: hidden;
        }

        /* Favorites Section */
        .favorites-section {
            margin-bottom: 40px;
            display: none;
        }

        .favorites-section.active {
            display: block;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .governorates-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .specialties-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .nav-links {
                display: none;
            }

            .menu-toggle {
                display: block;
            }

            .user-header {
                flex-direction: column;
                text-align: center;
            }

            .user-avatar {
                margin-left: 0;
                margin-bottom: 15px;
            }

            .schedule-days {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .bottom-nav {
                display: block;
            }

            .doctor-main-info {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .doctor-details-avatar {
                margin-left: 0;
                margin-bottom: 15px;
            }

            .doctor-details-text {
                text-align: center;
            }

            .doctor-details-phone, .doctor-details-location {
                justify-content: center;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .slide-up {
            animation: slideUp 0.5s ease forwards;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--secondary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">القائمة</h3>
            <button class="close-sidebar" id="closeSidebar">&times;</button>
        </div>
        <div class="sidebar-menu">
            <a href="#" id="profileLink">
                <i class="fas fa-user"></i>
                <span>الملف الشخصي</span>
            </a>
            <a href="#" id="settingsLink">
                <i class="fas fa-cog"></i>
                <span>الإعدادات</span>
            </a>
            <a href="tabl.html">
                <i class="fas fa-calendar-check"></i>
                <span>تنظيم المواعيد</span>
            </a>
            <a href="#" id="logoutLink">
                <i class="fas fa-sign-out-alt"></i>
                <span>تسجيل الخروج</span>
            </a>
        </div>
    </div>

    <!-- Governorate Selection Modal -->
    <div class="modal-overlay" id="governorateModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>اختر محافظتك</h2>
            </div>
            <div class="modal-body">
                <div class="governorates-grid" id="governoratesGrid">
                    <!-- Governorates will be added here by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="autoDetectBtn">التحديد التلقائي</button>
                <button class="btn btn-primary" id="confirmGovernorateBtn" disabled>تأكيد</button>
            </div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <span>طبيبك</span>
                <i class="fas fa-heartbeat"></i>
            </div>
            <ul class="nav-links">
                <li><a href="#"><i class="fas fa-home"></i> الرئيسية</a></li>
                <li><a href="#" id="searchLink"><i class="fas fa-search"></i> البحث</a></li>
<li><a href="tabl.html"><i class="fas fa-stopwatch"></i> منظم الوقت </a></li>
                <li>
                    <div class="user-profile" id="userProfile">
                        <img src="" alt="User" id="userAvatar">
                        <span id="userNameNav">مستخدم</span>
                        <div class="user-dropdown">
                            <a href="#" id="profileDropdownLink"><i class="fas fa-user"></i> الملف الشخصي</a>
                            <a href="#" id="settingsDropdownLink"><i class="fas fa-cog"></i> الإعدادات</a>
                            <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</a>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <!-- User Header -->
        <div class="user-header">
            <img src="" alt="User" class="user-avatar" id="userAvatarBig">
            <div class="user-info">
                <h1 class="user-name" id="userName"> </h1>
                <p class="user-phone" id="userPhone"></p>
                <div class="governorate-selector">
                    <select class="select-governorate" id="governorateSelect">
                        <option value="">اختر المحافظة</option>
                        <!-- Governorates will be added here by JavaScript -->
                    </select>
                </div>
            </div>
        </div>

        <!-- Specialties Section -->
        <div class="specialties-section" id="specialtiesSection">
            <h2 class="section-title">التخصصات الطبية</h2>
            <div class="search-container">
                <input type="text" class="search-input" id="specialtySearch" placeholder="ابحث عن تخصص أو طبيب...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="specialties-grid" id="specialtiesGrid">
                <!-- Specialties will be added here by JavaScript -->
            </div>
        </div>

        <!-- Favorites Section -->
        <div class="specialties-section favorites-section" id="favoritesSection">
            <h2 class="section-title">الأطباء المفضلين</h2>
            <div class="specialties-grid" id="favoritesGrid">
                <!-- Favorites will be added here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="bottom-nav-container">
            <a href="#" class="bottom-nav-item active" id="bottomHome">
                <i class="fas fa-home"></i>
                <span>الرئيسية</span>
            </a>
            <a href="#" class="bottom-nav-item" id="bottomSearch">
                <i class="fas fa-search"></i>
                <span>البحث</span>
            </a>
            <a href="tabl.html" class="bottom-nav-item">
                <i class="fas fa-clock"></i>
                <span>منظم الوقت</span>
            </a>
            <a href="#" class="bottom-nav-item" id="bottomProfile">
                <i class="fas fa-user"></i>
                <span>حسابي</span>
            </a>
        </div>
    </nav>

    <!-- Doctors Modal -->
    <div class="doctors-modal" id="doctorsModal">
        <div class="doctors-container">
            <div class="doctors-header">
                <h3 class="doctors-title" id="doctorsModalTitle">الأطباء</h3>
                <button class="close-doctors" id="closeDoctorsModal">&times;</button>
            </div>
            <div class="doctors-list" id="doctorsList">
                <!-- Doctors will be added here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Doctor Details Modal -->
    <div class="doctor-details-modal" id="doctorDetailsModal">
        <div class="doctor-details-container">
            <div class="doctor-details-header">
                <h3 class="doctor-details-title">تفاصيل الطبيب</h3>
                <button class="close-doctor-details" id="closeDoctorDetailsModal">&times;</button>
            </div>
            <div class="doctor-details-body" id="doctorDetailsBody">
                <!-- Doctor details will be added here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Consultation Modal -->
    <div class="consultation-modal" id="consultationModal">
        <div class="consultation-container">
            <div class="consultation-header">
                <h3 class="consultation-title">حجز استشارة</h3>
                <button class="close-consultation" id="closeConsultationModal">&times;</button>
            </div>
            <div class="consultation-body">
                <form id="consultationForm">
                    <input type="hidden" id="doctorId">
                    <div class="form-group">
                        <label for="fullName" class="form-label">الاسم الكامل</label>
                        <input type="text" class="form-input" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="address" class="form-label">العنوان</label>
                        <input type="text" class="form-input" id="address" required>
                    </div>
                    <div class="form-group">
                        <label for="consultationGovernorate" class="form-label">المحافظة</label>
                        <select class="form-input" id="consultationGovernorate" required>
                            <option value="">اختر المحافظة</option>
                            <!-- Governorates will be added here by JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="consultationPhone" class="form-label">رقم الهاتف</label>
                        <input type="tel" class="form-input" id="consultationPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="consultationNotes" class="form-label">ملاحظات (اختياري)</label>
                        <textarea class="form-input" id="consultationNotes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="submit-consultation">
                        <span id="submitText">إرسال الاستشارة</span>
                        <span id="submitSpinner" class="spinner" style="display: none;"></span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="ai-modal" id="aiModal">
        <div class="ai-container">
            <div class="ai-header">
                <h3 class="ai-title">الطبيب الافتراضي</h3>
                <button class="close-ai" id="closeAiModal">&times;</button>
            </div>
            <div class="ai-chat" id="aiChat">
                <div class="message ai-message">
                    مرحباً! أنا الطبيب الافتراضي. كيف يمكنني مساعدتك اليوم؟
                </div>
            </div>
            <div class="ai-input-container">
                <input type="text" class="ai-input" id="aiInput" placeholder="اكتب سؤالك هنا...">
                <button class="send-ai" id="sendAiMessage">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-container">
            <div class="profile-header">
                <h3 class="profile-title">الملف الشخصي</h3>
                <button class="close-profile" id="closeProfileModal">&times;</button>
            </div>
            <div class="profile-body">
                <div class="profile-info">
                    <img src="" alt="User" class="profile-avatar" id="profileAvatar">
                    <h2 class="profile-name" id="profileName">محمود محمد</h2>
                    <p class="profile-email" id="profileEmail">user@example.com</p>
                </div>
                <div class="profile-details">
                    <div class="detail-row">
                        <span class="detail-label">رقم الهاتف:</span>
                        <span class="detail-value" id="profilePhone">01123961290</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">المحافظة:</span>
                        <span class="detail-value" id="profileGovernorate">القاهرة</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">تاريخ التسجيل:</span>
                        <span class="detail-value" id="profileJoinDate">01/01/2023</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-container">
            <div class="settings-header">
                <h3 class="settings-title">الإعدادات</h3>
                <button class="close-settings" id="closeSettingsModal">&times;</button>
            </div>
            <div class="settings-body">
                <div class="settings-tabs">
                    <div class="settings-tab active" data-tab="account">حسابي</div>
                    <div class="settings-tab" data-tab="security">الأمان</div>
                    <div class="settings-tab" data-tab="notifications">الإشعارات</div>
                </div>
                
                <div class="settings-content active" id="accountSettings">
                    <div class="form-group">
                        <label for="settingsName" class="form-label">الاسم الكامل</label>
                        <input type="text" class="form-input" id="settingsName">
                    </div>
                    <div class="form-group">
                        <label for="settingsEmail" class="form-label">البريد الإلكتروني</label>
                        <input type="email" class="form-input" id="settingsEmail">
                    </div>
                    <div class="form-group">
                        <label for="settingsPhone" class="form-label">رقم الهاتف</label>
                        <input type="tel" class="form-input" id="settingsPhone">
                    </div>
                    <div class="form-group">
                        <label for="settingsGovernorate" class="form-label">المحافظة</label>
                        <select class="form-input" id="settingsGovernorate">
                            <option value="">اختر المحافظة</option>
                            <!-- Governorates will be added here by JavaScript -->
                        </select>
                    </div>
                    <button class="btn btn-primary" id="saveProfileBtn">حفظ التغييرات</button>
                </div>
                
                <div class="settings-content" id="securitySettings">
                    <div class="form-group">
                        <label for="currentPassword" class="form-label">كلمة المرور الحالية</label>
                        <input type="password" class="form-input" id="currentPassword">
                    </div>
                    <div class="form-group">
                        <label for="newPassword" class="form-label">كلمة المرور الجديدة</label>
                        <input type="password" class="form-input" id="newPassword">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">تأكيد كلمة المرور</label>
                        <input type="password" class="form-input" id="confirmPassword">
                    </div>
                    <button class="btn btn-primary" id="changePasswordBtn">تغيير كلمة المرور</button>
                </div>
                
                <div class="settings-content" id="notificationsSettings">
                    <div class="form-group">
                        <label class="form-label">إشعارات التطبيق</label>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span>تفعيل الإشعارات</span>
                            <label class="switch">
                                <input type="checkbox" id="notificationsToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">إشعارات البريد الإلكتروني</label>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span>تفعيل الإشعارات</span>
                            <label class="switch">
                                <input type="checkbox" id="emailNotificationsToggle" checked>
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">إشعارات الرسائل القصيرة</label>
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span>تفعيل الإشعارات</span>
                            <label class="switch">
                                <input type="checkbox" id="smsNotificationsToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="saveNotificationsBtn">حفظ التغييرات</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Map Modal -->
    <div class="map-modal" id="mapModal">
        <div class="map-container">
            <div class="map-header">
                <h3 class="map-title">موقع العيادة</h3>
                <button class="close-map" id="closeMapModal">&times;</button>
            </div>
            <div class="map-body">
                <div class="map-info">
                    <h3 id="mapDoctorName"></h3>
                    <p id="mapDoctorSpecialty"></p>
                    <p id="mapDoctorAddress"></p>
                </div>
                <div id="doctorMap"></div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Governorates Data
        const governorates = [
            "القاهرة", "الإسكندرية", "الجيزة", "القليوبية", "الدقهلية", 
            "الشرقية", "الغربية", "المنوفية", "البحيرة", "كفر الشيخ", 
            "دمياط", "بورسعيد", "الإسماعيلية", "السويس", "شمال سيناء", 
            "جنوب سيناء", "البحر الأحمر", "الفيوم", "بني سويف", "المنيا", 
            "أسيوط", "سوهاج", "قنا", "الأقصر", "أسوان", "الوادي الجديد", 
            "مرسى مطروح"
        ];

        // Medical Specialties
       const specialties = [
    { name: "أمراض القلب", icon: "fa-solid fa-heart-pulse", color: "#e63946" },
    { name: "الأعصاب", icon: "fa-solid fa-brain", color: "#457b9d" },
    { name: "العظام", icon: "fa-solid fa-bone", color: "#f4a261" },
    { name: "الباطنة", icon: "fa-solid fa-user-doctor", color: "#2a9d8f" },
    { name: "الأطفال", icon: "fa-solid fa-baby", color: "#9d4edd" },
    { name: "الجلدية", icon: "fa-solid fa-allergies", color: "#14b8a6" },
    { name: "العيون", icon: "fa-solid fa-eye", color: "#f77f00" },
    { name: "الأنف والأذن", icon: "fa-solid fa-ear-listen", color: "#6c757d" },
    { name: "النساء والتوليد", icon: "fa-solid fa-person-pregnant", color: "#d00000" },
    { name: "الأورام", icon: "fa-solid fa-ribbon", color: "#6d6875" },
    { name: "الجراحة", icon: "fa-solid fa-scissors", color: "#b02a30" },
    { name: "التخدير", icon: "fa-solid fa-syringe", color: "#8e44ad" },
    { name: "الأسنان", icon: "fa-solid fa-tooth", color: "#16a085" },
    { name: "الطب النفسي", icon: "fa-solid fa-head-side-virus", color: "#2d6a4f" },
    { name: "العلاج الطبيعي", icon: "fa-solid fa-hand-holding-heart", color: "#1d3557" },
    { name: "التغذية", icon: "fa-solid fa-apple-whole", color: "#f1c40f" }
];

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const closeSidebar = document.getElementById('closeSidebar');
        const governorateModal = document.getElementById('governorateModal');
        const governorsGrid = document.getElementById('governoratesGrid');
        const autoDetectBtn = document.getElementById('autoDetectBtn');
        const confirmGovernorateBtn = document.getElementById('confirmGovernorateBtn');
        const governorateSelect = document.getElementById('governorateSelect');
        const consultationGovernorate = document.getElementById('consultationGovernorate');
        const settingsGovernorate = document.getElementById('settingsGovernorate');
        const specialtiesGrid = document.getElementById('specialtiesGrid');
        const favoritesGrid = document.getElementById('favoritesGrid');
        const specialtySearch = document.getElementById('specialtySearch');
        const doctorsModal = document.getElementById('doctorsModal');
        const doctorsModalTitle = document.getElementById('doctorsModalTitle');
        const doctorsList = document.getElementById('doctorsList');
        const closeDoctorsModal = document.getElementById('closeDoctorsModal');
        const doctorDetailsModal = document.getElementById('doctorDetailsModal');
        const doctorDetailsBody = document.getElementById('doctorDetailsBody');
        const closeDoctorDetailsModal = document.getElementById('closeDoctorDetailsModal');
        const consultationModal = document.getElementById('consultationModal');
        const consultationForm = document.getElementById('consultationForm');
        const closeConsultationModal = document.getElementById('closeConsultationModal');
        const submitText = document.getElementById('submitText');
        const submitSpinner = document.getElementById('submitSpinner');
        const aiModal = document.getElementById('aiModal');
        const aiChat = document.getElementById('aiChat');
        const aiInput = document.getElementById('aiInput');
        const sendAiMessage = document.getElementById('sendAiMessage');
        const closeAiModal = document.getElementById('closeAiModal');
        const searchLink = document.getElementById('searchLink');
        const aiLink = document.getElementById('aiLink');
        const userProfile = document.getElementById('userProfile');
        const userNameNav = document.getElementById('userNameNav');
        const userAvatar = document.getElementById('userAvatar');
        const userAvatarBig = document.getElementById('userAvatarBig');
        const userName = document.getElementById('userName');
        const userPhone = document.getElementById('userPhone');
        const logoutBtn = document.getElementById('logoutBtn');
        const profileModal = document.getElementById('profileModal');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profilePhone = document.getElementById('profilePhone');
        const profileGovernorate = document.getElementById('profileGovernorate');
        const profileJoinDate = document.getElementById('profileJoinDate');
        const closeProfileModal = document.getElementById('closeProfileModal');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsModal = document.getElementById('closeSettingsModal');
        const settingsTabs = document.querySelectorAll('.settings-tab');
        const settingsContents = document.querySelectorAll('.settings-content');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const saveNotificationsBtn = document.getElementById('saveNotificationsBtn');
        const profileLink = document.getElementById('profileLink');
        const profileDropdownLink = document.getElementById('profileDropdownLink');
        const settingsLink = document.getElementById('settingsLink');
        const settingsDropdownLink = document.getElementById('settingsDropdownLink');
        const logoutLink = document.getElementById('logoutLink');
        const bottomHome = document.getElementById('bottomHome');
        const bottomSearch = document.getElementById('bottomSearch');
        const bottomAi = document.getElementById('bottomAi');
        const bottomProfile = document.getElementById('bottomProfile');
        const mapModal = document.getElementById('mapModal');
        const closeMapModal = document.getElementById('closeMapModal');
        const mapDoctorName = document.getElementById('mapDoctorName');
        const mapDoctorSpecialty = document.getElementById('mapDoctorSpecialty');
        const mapDoctorAddress = document.getElementById('mapDoctorAddress');
        const doctorMap = document.getElementById('doctorMap');
        const specialtiesSection = document.getElementById('specialtiesSection');
        const favoritesSection = document.getElementById('favoritesSection');
        const favoritesLink = document.getElementById('favoritesLink');

        // Global Variables
        let selectedGovernorate = '';
        let currentSpecialty = '';
        let doctorsData = [];
        let userData = {};
        let currentDoctor = null;
        let map = null;
        let aiChatHistory = [];
        let favoriteDoctors = JSON.parse(localStorage.getItem('favoriteDoctors')) || [];

        // Initialize App
        function initApp() {
            // Load user data
            fetchUserData();
            
            // Load doctors data
            fetchDoctorsData();
            
            // Populate governorates
            populateGovernorates();
            
            // Populate specialties
            populateSpecialties();
            
            // Check if governorate is already selected
            const savedGovernorate = localStorage.getItem('selectedGovernorate');
            if (savedGovernorate) {
                selectedGovernorate = savedGovernorate;
                governorateSelect.value = savedGovernorate;
            } else {
                // Show governorate modal if not selected
                setTimeout(() => {
                    governorateModal.classList.add('active');
                }, 1000);
            }
            
            // Set up event listeners
            setupEventListeners();
        }

        // Fetch User Data
        async function fetchUserData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Devolepor/Object-/main/data.json');
                const data = await response.json();
                userData = data.users[0];
                displayUserData();
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }

        // Display User Data
        function displayUserData() {
            userName.textContent = userData.fullName;
            userNameNav.textContent = userData.fullName.split(' ')[0]; // Show first name only in nav
            userPhone.textContent = userData.phone;
            profileName.textContent = userData.fullName;
            profileEmail.textContent = userData.email || '';
            profilePhone.textContent = userData.phone;
            profileGovernorate.textContent = userData.governorate || 'غير محدد';
            profileJoinDate.textContent = userData.joinDate || '';
            
            // Set user avatar (using placeholder if not available)
            const avatarUrl = userData.image || 'https://randomuser.me/api/portraits/men/1.jpg';
            userAvatar.src = avatarUrl;
            userAvatarBig.src = avatarUrl;
            profileAvatar.src = avatarUrl;
            
            // Set governorate if available
            if (userData.governorate) {
                selectedGovernorate = userData.governorate;
                governorateSelect.value = userData.governorate;
                consultationGovernorate.value = userData.governorate;
                settingsGovernorate.value = userData.governorate;
                localStorage.setItem('selectedGovernorate', userData.governorate);
            }
        }

        // Fetch Doctors Data
        async function fetchDoctorsData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Devolepor/Object-/main/doc.json');
                const data = await response.json();
                doctorsData = data.doctors;
                // Update favorites with latest doctor data
                updateFavoritesWithLatestData();
            } catch (error) {
                console.error('Error fetching doctors data:', error);
                // Fallback data if API fails

                updateFavoritesWithLatestData();
            }
        }

        // Update favorites with latest doctor data
        function updateFavoritesWithLatestData() {
            favoriteDoctors = favoriteDoctors.map(favId => {
                return doctorsData.find(doctor => doctor.id === favId) || favId;
            }).filter(doctor => doctor); // Remove undefined entries
            localStorage.setItem('favoriteDoctors', JSON.stringify(favoriteDoctors));
            displayFavorites();
        }

        // Populate Governorates
        function populateGovernorates() {
            // Clear existing options
            governorsGrid.innerHTML = '';
            governorateSelect.innerHTML = '<option value="">اختر المحافظة</option>';
            consultationGovernorate.innerHTML = '<option value="">اختر المحافظة</option>';
            settingsGovernorate.innerHTML = '<option value="">اختر المحافظة</option>';
            
            // Add governorates to all selectors
            governorates.forEach(gov => {
                // Add to grid in modal
                const govBtn = document.createElement('div');
                govBtn.className = 'governorate-btn';
                govBtn.textContent = gov;
                govBtn.addEventListener('click', () => selectGovernorate(gov));
                governorsGrid.appendChild(govBtn);
                
                // Add to select dropdowns
                const option1 = document.createElement('option');
                option1.value = gov;
                option1.textContent = gov;
                governorateSelect.appendChild(option1.cloneNode(true));
                
                const option2 = document.createElement('option');
                option2.value = gov;
                option2.textContent = gov;
                consultationGovernorate.appendChild(option2.cloneNode(true));
                
                const option3 = document.createElement('option');
                option3.value = gov;
                option3.textContent = gov;
                settingsGovernorate.appendChild(option3);
            });
        }

        // Select Governorate
        function selectGovernorate(gov) {
            // Remove active class from all buttons
            document.querySelectorAll('.governorate-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected button
            event.target.classList.add('active');
            
            // Enable confirm button
            confirmGovernorateBtn.disabled = false;
            
            // Set selected governorate
            selectedGovernorate = gov;
        }

        // Populate Specialties
        function populateSpecialties() {
            specialtiesGrid.innerHTML = '';
            
            specialties.forEach(spec => {
                const specialtyCard = document.createElement('div');
                specialtyCard.className = 'specialty-card slide-up';
                specialtyCard.innerHTML = `
                    <div class="specialty-icon" style="background: linear-gradient(135deg, ${spec.color}, ${adjustColor(spec.color, -20)})">
                        <i class="fas ${spec.icon}"></i>
                    </div>
                    <div class="specialty-info">
                        <h3 class="specialty-name">${spec.name}</h3>
                        <p class="specialty-doctors">${getDoctorCountBySpecialty(spec.name)} أطباء متاحون</p>
                    </div>
                `;
                
                specialtyCard.addEventListener('click', () => openDoctorsModal(spec.name));
                specialtiesGrid.appendChild(specialtyCard);
            });
        }

        // Display Favorites
        function displayFavorites() {
            favoritesGrid.innerHTML = '';
            
            if (favoriteDoctors.length === 0) {
                favoritesGrid.innerHTML = '<p style="text-align: center; width: 100%;">لا يوجد أطباء في المفضلة</p>';
                return;
            }
            
            favoriteDoctors.forEach(doctor => {
                if (typeof doctor === 'number') {
                    // If it's just an ID, find the full doctor data
                    doctor = doctorsData.find(d => d.id === doctor);
                    if (!doctor) return;
                }
                
                const specialty = specialties.find(s => s.name === doctor.specialty);
                const specialtyCard = document.createElement('div');
                specialtyCard.className = 'specialty-card slide-up';
                specialtyCard.innerHTML = `
                    <div class="specialty-icon" style="background: linear-gradient(135deg, ${specialty?.color || '#036447'}, ${adjustColor(specialty?.color || '#036447', -20)})">
                        <i class="fas ${specialty?.icon || 'fa-user-md'}"></i>
                    </div>
                    <div class="specialty-info">
                        <h3 class="specialty-name">${doctor.name}</h3>
                        <p class="specialty-doctors">${doctor.specialty}</p>
                    </div>
                `;
                
                specialtyCard.addEventListener('click', () => openDoctorDetails(doctor));
                favoritesGrid.appendChild(specialtyCard);
            });
        }

        // Get doctor count by specialty and governorate
        function getDoctorCountBySpecialty(specialty) {
            if (!selectedGovernorate) return Math.floor(Math.random() * 20) + 5;
            
            return doctorsData.filter(doctor => 
                doctor.specialty === specialty && 
                doctor.governorate === selectedGovernorate
            ).length;
        }

        // Adjust color brightness
        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => ('0'+Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
        }

        // Open Doctors Modal
        function openDoctorsModal(specialty) {
            currentSpecialty = specialty;
            doctorsModalTitle.textContent = `أطباء ${specialty}`;
            
            // Filter doctors by specialty and governorate
            let filteredDoctors = doctorsData.filter(doctor => doctor.specialty === specialty);
            
            if (selectedGovernorate) {
                filteredDoctors = filteredDoctors.filter(doctor => doctor.governorate === selectedGovernorate);
            }
            
            // Display doctors
            displayDoctors(filteredDoctors);
            
            // Show modal
            doctorsModal.classList.add('active');
        }

        // Display Doctors
        function displayDoctors(doctors) {
            doctorsList.innerHTML = '';
            
            if (doctors.length === 0) {
                doctorsList.innerHTML = '<p style="text-align: center; width: 100%;">لا يوجد أطباء متاحون لهذا التخصص حالياً في محافظتك</p>';
                return;
            }
            
            doctors.forEach(doctor => {
                const isFavorite = favoriteDoctors.some(fav => (typeof fav === 'object' ? fav.id : fav) === doctor.id);
                
                const doctorCard = document.createElement('div');
                doctorCard.className = 'doctor-card';
                doctorCard.innerHTML = `
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-doctor-id="${doctor.id}">
                        <i class="fas fa-heart"></i>
                    </button>
                    <img src="${doctor.image || 'https://randomuser.me/api/portraits/men/1.jpg'}" alt="${doctor.name}" class="doctor-avatar">
                    <div class="doctor-info">
                        <h4 class="doctor-name">${doctor.name}</h4>
                        <p class="doctor-specialty">${doctor.specialty}</p>
                        <p class="doctor-phone"><i class="fas fa-phone"></i> ${doctor.phone}</p>
                        <p class="doctor-location"><i class="fas fa-map-marker-alt"></i> ${doctor.governorate}</p>
                    </div>
                    <button class="view-doctor">عرض</button>
                `;
                
                doctorCard.querySelector('.view-doctor').addEventListener('click', () => openDoctorDetails(doctor));
                doctorCard.querySelector('.favorite-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(doctor.id);
                    const btn = e.target.closest('.favorite-btn');
                    btn.classList.toggle('active');
                });
                
                doctorsList.appendChild(doctorCard);
            });
        }

        // Toggle Favorite
        function toggleFavorite(doctorId) {
            const index = favoriteDoctors.findIndex(fav => (typeof fav === 'object' ? fav.id : fav) === doctorId);
            
            if (index === -1) {
                // Add to favorites
                const doctor = doctorsData.find(d => d.id === doctorId);
                if (doctor) {
                    favoriteDoctors.push(doctor);
                } else {
                    favoriteDoctors.push(doctorId);
                }
            } else {
                // Remove from favorites
                favoriteDoctors.splice(index, 1);
            }
            
            localStorage.setItem('favoriteDoctors', JSON.stringify(favoriteDoctors));
            displayFavorites();
        }

        // Open Doctor Details
        function openDoctorDetails(doctor) {
            currentDoctor = doctor;
            const isFavorite = favoriteDoctors.some(fav => (typeof fav === 'object' ? fav.id : fav) === doctor.id);
            
            doctorDetailsBody.innerHTML = `
                <div class="doctor-main-info">
                    <img src="${doctor.image || 'https://randomuser.me/api/portraits/men/1.jpg'}" alt="${doctor.name}" class="doctor-details-avatar">
                    <div class="doctor-details-text">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 class="doctor-details-name">${doctor.name}</h3>
                            <button class="favorite-btn ${isFavorite ? 'active' : ''}" id="doctorFavoriteBtn" data-doctor-id="${doctor.id}" style="margin: 0;">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <p class="doctor-details-specialty"><i class="fas fa-user-md"></i> ${doctor.specialty}</p>
                        <p class="doctor-details-phone"><i class="fas fa-phone"></i> ${doctor.phone}</p>
                        <p class="doctor-details-location"><i class="fas fa-map-marker-alt"></i> ${doctor.location || 'غير محدد'}, ${doctor.governorate || 'غير محدد'}</p>
                        ${doctor.mapLink ? `<button class="btn btn-secondary" id="viewMapBtn" style="margin-top: 10px;"><i class="fas fa-map"></i> عرض الخريطة</button>` : ''}
                    </div>
                </div>
                
                ${doctor.description ? `
                <div class="doctor-description">
                    <h4 style="margin-bottom: 10px; color: var(--primary-color);">نبذة عن الطبيب</h4>
                    <p>${doctor.description}</p>
                </div>
                ` : ''}
                
                ${doctor.rating ? `
                <div class="doctor-rating">
                    <span class="rating-stars">
                        ${'<i class="fas fa-star"></i>'.repeat(Math.floor(doctor.rating))}
                        ${doctor.rating % 1 >= 0.5 ? '<i class="fas fa-star-half-alt"></i>' : ''}
                    </span>
                    <span class="rating-count">(${doctor.rating.toFixed(1)})</span>
                    <span class="rating-count">${doctor.reviews} تقييم</span>
                </div>
                ` : ''}
                
                ${doctor.price ? `
                <div class="doctor-price">
                    سعر الكشف: ${doctor.price} ج.م
                </div>
                ` : ''}
                
                <div class="doctor-schedule">
                    <h4 class="schedule-title">مواعيد العمل</h4>
                    <div class="schedule-days">
                        ${generateScheduleDays(doctor.schedule)}
                    </div>
                </div>
                <button class="book-consultation-btn" id="bookConsultationBtn">حجز استشارة</button>
            `;
            
            document.getElementById('bookConsultationBtn').addEventListener('click', openConsultationModal);
            
            if (doctor.mapLink) {
                document.getElementById('viewMapBtn').addEventListener('click', openMapModal);
            }
            
            document.getElementById('doctorFavoriteBtn').addEventListener('click', (e) => {
                toggleFavorite(doctor.id);
                e.target.classList.toggle('active');
            });
            
            // Close doctors modal and open details modal
            doctorsModal.classList.remove('active');
            setTimeout(() => {
                doctorDetailsModal.classList.add('active');
            }, 300);
        }

        // Open Map Modal
        function openMapModal() {
            mapDoctorName.textContent = currentDoctor.name;
            mapDoctorSpecialty.textContent = currentDoctor.specialty;
            mapDoctorAddress.textContent = currentDoctor.location ? `${currentDoctor.location}, ${currentDoctor.governorate}` : 'غير محدد';
            
            // Close doctor details modal and open map modal
            doctorDetailsModal.classList.remove('active');
            setTimeout(() => {
                mapModal.classList.add('active');
                initMap();
            }, 300);
        }

        // Initialize Map
        function initMap() {
            if (map) {
                map.remove();
            }
            
            // Use doctor's coordinates if available, otherwise use default Cairo coordinates
            const coords = currentDoctor.latitude && currentDoctor.longitude ? 
                [currentDoctor.latitude, currentDoctor.longitude] : 
                [30.0444, 31.2357];
            
            map = L.map('doctorMap').setView(coords, 15);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add marker for doctor's location
            L.marker(coords).addTo(map)
                .bindPopup(`<b>${currentDoctor.name}</b><br>${currentDoctor.specialty}`)
                .openPopup();
        }

        // Generate Schedule Days
        function generateScheduleDays(schedule) {
            if (!schedule) {
                return '<p>لا يوجد مواعيد متاحة حالياً</p>';
            }
            
            const days = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            let html = '';
            
            days.forEach(day => {
                const daySchedule = schedule[day];
                if (daySchedule && daySchedule.available) {
                    html += `
                        <div class="schedule-day">
                            <div class="day-name">${day}</div>
                            <div class="day-time">${daySchedule.from} - ${daySchedule.to}</div>
                        </div>
                    `;
                }
            });
            
            return html || '<p>لا يوجد مواعيد متاحة حالياً</p>';
        }

        // Open Consultation Modal
        function openConsultationModal() {
            // Set doctor ID in form
            document.getElementById('doctorId').value = currentDoctor.id;
            
            // Set default values from user data
            document.getElementById('fullName').value = userData.fullName;
            document.getElementById('address').value = '';
            document.getElementById('consultationGovernorate').value = selectedGovernorate;
            document.getElementById('consultationPhone').value = userData.phone;
            document.getElementById('consultationNotes').value = '';
            
            // Close doctor details modal and open consultation modal
            doctorDetailsModal.classList.remove('active');
            setTimeout(() => {
                consultationModal.classList.add('active');
            }, 300);
        }

        // Submit Consultation Form
        async function submitConsultationForm(e) {
            e.preventDefault();
            
            // Show loading spinner
            submitText.style.display = 'none';
            submitSpinner.style.display = 'inline-block';
            
            // Get form data
            const formData = {
                doctorId: document.getElementById('doctorId').value,
                doctorName: currentDoctor.name,
                doctorPhone: currentDoctor.phone,
                fullName: document.getElementById('fullName').value,
                address: document.getElementById('address').value,
                governorate: document.getElementById('consultationGovernorate').value,
                phone: document.getElementById('consultationPhone').value,
                notes: document.getElementById('consultationNotes').value,
                timestamp: new Date().toISOString()
            };
            
            // In a real app, you would send this data to your backend
            // For this demo, we'll simulate a successful submission
            setTimeout(() => {
                // Hide spinner and show success
                submitSpinner.style.display = 'none';
                submitText.style.display = 'inline';
                submitText.textContent = 'تم الإرسال بنجاح!';
                
                // Close modal after 2 seconds
                setTimeout(() => {
                    consultationModal.classList.remove('active');
                    submitText.textContent = 'إرسال الاستشارة';
                    
                    // Show success message
                    alert(`تم إرسال الاستشارة بنجاح إلى الدكتور ${currentDoctor.name}\nسيتم التواصل معك على الرقم ${formData.phone}`);
                    
                    // Open WhatsApp with the doctor's phone number
                    const whatsappMessage = `استشارة طبية جديدة%0A%0Aالاسم: ${formData.fullName}%0Aالعنوان: ${formData.address}%0Aالمحافظة: ${formData.governorate}%0Aرقم الهاتف: ${formData.phone}%0Aملاحظات: ${formData.notes || 'لا يوجد'}`;
                    const whatsappUrl = `https://wa.me/${currentDoctor.phone.replace(/^0/, '+20')}?text=${whatsappMessage}`;
                    window.open(whatsappUrl, '_blank');
                }, 2000);
            }, 1500);
        }

        // Send AI Message
        async function sendAiMessageHandler() {
            const message = aiInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            aiInput.value = '';
            
            // Add loading indicator
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'message ai-message';
            loadingMessage.innerHTML = '<div class="spinner"></div>';
            aiChat.appendChild(loadingMessage);
            aiChat.scrollTop = aiChat.scrollHeight;
            
            // In a real app, you would call your AI API here
            // For this demo, we'll simulate an API call
            try {
                const response = await simulateAiApiCall(message);
                removeLoadingMessage();
                addMessageToChat(response, 'ai');
            } catch (error) {
                removeLoadingMessage();
                addMessageToChat("عذراً، حدث خطأ في الاتصال بالطبيب الافتراضي. يرجى المحاولة مرة أخرى لاحقاً.", 'ai');
            }
        }

        // Simulate AI API call
        function simulateAiApiCall(message) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const responses = [
                        "أنا آسف، لكن كطبيب افتراضي، لا يمكنني تقديم تشخيص طبي دقيق. يوصى باستشارة طبيب مؤهل للحصول على تقييم مناسب.",
                        "بناءً على الأعراض التي ذكرتها، قد يكون من الأفضل مراجعة طبيب متخصص في أقرب وقت ممكن.",
                        "هذا السؤال يتطلب فحصًا سريريًا. أنصحك بزيارة الطبيب لإجراء الفحوصات اللازمة.",
                        "للحصول على أفضل رعاية طبية، يوصى بزيارة عيادة أو مستشفى قريب منك.",
                        "تذكر أن المعلومات التي أقدمها هي لأغراض عامة فقط ولا تغني عن استشارة الطبيب."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    resolve(randomResponse);
                }, 1500);
            });
        }

        // Remove loading message
        function removeLoadingMessage() {
            const messages = aiChat.querySelectorAll('.message');
            const lastMessage = messages[messages.length - 1];
            if (lastMessage.querySelector('.spinner')) {
                lastMessage.remove();
            }
        }

        // Add Message to Chat
        function addMessageToChat(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${sender}-message`;
            messageElement.textContent = message;
            aiChat.appendChild(messageElement);
            aiChat.scrollTop = aiChat.scrollHeight;
            
            // Add to chat history
            aiChatHistory.push({ sender, message });
        }

        // Save User Data
        function saveUserData() {
            // In a real app, you would send this data to your backend
            // For this demo, we'll just update the local data
            userData = {
                ...userData,
                fullName: document.getElementById('settingsName').value,
                email: document.getElementById('settingsEmail').value,
                phone: document.getElementById('settingsPhone').value,
                governorate: document.getElementById('settingsGovernorate').value
            };
            
            displayUserData();
            alert('تم حفظ التغييرات بنجاح');
        }

        // Change Password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('كلمة المرور الجديدة غير متطابقة');
                return;
            }
            
            // In a real app, you would verify current password and update it
            alert('تم تغيير كلمة المرور بنجاح');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Sidebar toggle
            menuToggle.addEventListener('click', () => {
                sidebar.classList.add('active');
            });
            
            closeSidebar.addEventListener('click', () => {
                sidebar.classList.remove('active');
            });
            
            // Governorate modal
            autoDetectBtn.addEventListener('click', () => {
                // In a real app, you would use geolocation to detect governorate
                // For this demo, we'll simulate detection
                const randomGov = governorates[Math.floor(Math.random() * governorates.length)];
                selectedGovernorate = randomGov;
                governorateSelect.value = randomGov;
                settingsGovernorate.value = randomGov;
                localStorage.setItem('selectedGovernorate', randomGov);
                
                // Show success message
                alert(`تم تحديد موقعك تلقائياً: ${randomGov}`);
                
                // Close modal
                governorateModal.classList.remove('active');
            });
            
            confirmGovernorateBtn.addEventListener('click', () => {
                if (selectedGovernorate) {
                    governorateSelect.value = selectedGovernorate;
                    settingsGovernorate.value = selectedGovernorate;
                    localStorage.setItem('selectedGovernorate', selectedGovernorate);
                    governorateModal.classList.remove('active');
                    
                    // Refresh specialties count
                    populateSpecialties();
                }
            });
            
            // Governorate select change
            governorateSelect.addEventListener('change', (e) => {
                selectedGovernorate = e.target.value;
                settingsGovernorate.value = e.target.value;
                localStorage.setItem('selectedGovernorate', e.target.value);
                
                // Refresh specialties count
                populateSpecialties();
            });
            
            // Search specialties
            specialtySearch.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                // Search in both specialties and doctors
                const specialtyCards = document.querySelectorAll('.specialty-card');
                let found = false;
                
                specialtyCards.forEach(card => {
                    const specialtyName = card.querySelector('.specialty-name').textContent.toLowerCase();
                    if (specialtyName.includes(searchTerm)) {
                        card.style.display = 'block';
                        found = true;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // If no specialties found, search in doctors
                if (!found) {
                    const filteredDoctors = doctorsData.filter(doctor => 
                        doctor.name.toLowerCase().includes(searchTerm) || 
                        doctor.specialty.toLowerCase().includes(searchTerm)
                    );
                    
                    if (filteredDoctors.length > 0) {
                        doctorsModalTitle.textContent = `نتائج البحث عن "${e.target.value}"`;
                        displayDoctors(filteredDoctors);
                        doctorsModal.classList.add('active');
                    }
                }
            });
            
            // Close modals
            closeDoctorsModal.addEventListener('click', () => {
                doctorsModal.classList.remove('active');
            });
            
            closeDoctorDetailsModal.addEventListener('click', () => {
                doctorDetailsModal.classList.remove('active');
            });
            
            closeConsultationModal.addEventListener('click', () => {
                consultationModal.classList.remove('active');
            });
            
            closeAiModal.addEventListener('click', () => {
                aiModal.classList.remove('active');
            });
            
            closeProfileModal.addEventListener('click', () => {
                profileModal.classList.remove('active');
            });
            
            closeSettingsModal.addEventListener('click', () => {
                settingsModal.classList.remove('active');
            });
            
            closeMapModal.addEventListener('click', () => {
                mapModal.classList.remove('active');
            });
            
            // Consultation form
            consultationForm.addEventListener('submit', submitConsultationForm);
            
            // AI Chat
            sendAiMessage.addEventListener('click', sendAiMessageHandler);
            aiInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendAiMessageHandler();
                }
            });
            
            // Profile links
            profileLink.addEventListener('click', (e) => {
                e.preventDefault();
                sidebar.classList.remove('active');
                profileModal.classList.add('active');
            });
            
            profileDropdownLink.addEventListener('click', (e) => {
                e.preventDefault();
                profileModal.classList.add('active');
            });
            
            // Settings links
            settingsLink.addEventListener('click', (e) => {
                e.preventDefault();
                sidebar.classList.remove('active');
                settingsModal.classList.add('active');
            });
            
            settingsDropdownLink.addEventListener('click', (e) => {
                e.preventDefault();
                settingsModal.classList.add('active');
            });
            
            // Settings tabs
            settingsTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    settingsTabs.forEach(t => t.classList.remove('active'));
                    settingsContents.forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}Settings`).classList.add('active');
                });
            });
            
            // Save buttons
            saveProfileBtn.addEventListener('click', saveUserData);
            changePasswordBtn.addEventListener('click', changePassword);
            
            // Logout
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('selectedGovernorate');
                alert('تم تسجيل الخروج بنجاح');
                window.location.href = 'login.html'; // Redirect to login page
            });
            
            logoutLink.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('selectedGovernorate');
                alert('تم تسجيل الخروج بنجاح');
                window.location.href = 'login.html'; // Redirect to login page
            });
            
            // Bottom navigation
            bottomHome.addEventListener('click', (e) => {
                e.preventDefault();
                specialtiesSection.classList.add('active');
                favoritesSection.classList.remove('active');
                setActiveBottomNav('home');
            });
            
            bottomSearch.addEventListener('click', (e) => {
                e.preventDefault();
                specialtySearch.focus();
                setActiveBottomNav('search');
            });
            
            bottomAi.addEventListener('click', (e) => {
                e.preventDefault();
                aiModal.classList.add('active');
                setActiveBottomNav('ai');
            });
            
            bottomProfile.addEventListener('click', (e) => {
                e.preventDefault();
                profileModal.classList.add('active');
                setActiveBottomNav('profile');
            });
            
            // Nav links
            searchLink.addEventListener('click', (e) => {
                e.preventDefault();
                specialtySearch.focus();
            });
            
            aiLink.addEventListener('click', (e) => {
                e.preventDefault();
                aiModal.classList.add('active');
            });
            
            // Favorites link
            favoritesLink.addEventListener('click', (e) => {
                e.preventDefault();
                sidebar.classList.remove('active');
                specialtiesSection.classList.remove('active');
                favoritesSection.classList.add('active');
                displayFavorites();
            });
        }

        // Set active bottom nav item
        function setActiveBottomNav(activeItem) {
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            switch(activeItem) {
                case 'home':
                    bottomHome.classList.add('active');
                    break;
                case 'search':
                    bottomSearch.classList.add('active');
                    break;
                case 'ai':
                    bottomAi.classList.add('active');
                    break;
                case 'profile':
                    bottomProfile.classList.add('active');
                    break;
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>